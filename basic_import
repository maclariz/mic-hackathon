# An experiment basic object ("datacube") has 2 "real space" dimensions (Rx,Ry), and 2 "momentum space" (AKA "reciprocal" or "diffraction") dimensions (Qx,Qy)
# With the way that these are acquired in the microscope, all 4 dimensions are (ideally) orthogonal.
# Since the acquisition is not instantaneous, we technically have Time as a 5th dimension, but it is not orthogonal like the other 4 dimensions.
# Each scan position is recorded in the ms-s range (Âµs for state of the art detectors).
# To visualize slices of the datacubes we can use hyperspy (general signal processing) and/or py4dstem (specialized for electron diffraction)

# With the following basic code we import the experimental data and visualize parts of it

# basic imports
import os
import numpy as np
import scipy as sp
import matplotlib.pyplot as plt
import py4DSTEM
import hyperspy.api as hs
import h5py

#load the raw data and visualize it, 
filepath = r"YOUR_PATH\4D-STEM data for wax\20210722_212158_data._binned2.hdf5"

#CHECK HOW TO LOAD METADATA (if necessary)
#py4DSTEM.print_h5_tree(filepath)

s = hs.load(filepath, reader='HSPY')
#test_mean = np.mean(s.inav[:,:].data, axis=(0,1))
test_max = np.max(s.inav[:,:].data, axis=(0,1)) #in hyperspy we use inav and isig to move in the real and momentum spaces respectively

plt.figure(figsize=(8,8))
plt.imshow(test_max, vmax = 100) #max value is only 252. lowering the visualization vmax shows the background noise

datacube = py4DSTEM.DataCube(s.data)
